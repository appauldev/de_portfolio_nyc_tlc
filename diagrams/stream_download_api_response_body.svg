<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2358px" height="1760px" viewBox="-0.5 -0.5 2358 1760" style="background-color: rgb(250, 250, 250);"><defs><pattern patternUnits="userSpaceOnUse" width="20.06" height="20.06" x="0" y="0" patternTransform="rotate(45)" id="mx-pattern-hatch-1.5-3399ff-0"><line x1="0" y1="0" x2="0" y2="20.06" stroke="#3399ff" stroke-width="3.375"/></pattern><pattern patternUnits="userSpaceOnUse" width="20.06" height="20.06" x="0" y="0" patternTransform="rotate(45)" id="mx-pattern-hatch-1.5-99ccff-0"><line x1="0" y1="0" x2="0" y2="20.06" stroke="#99ccff" stroke-width="3.375"/></pattern><pattern patternUnits="userSpaceOnUse" width="20.06" height="20.06" x="0" y="0" patternTransform="rotate(45)" id="mx-pattern-hatch-1.5-99ff99-0"><line x1="0" y1="0" x2="0" y2="20.06" stroke="#99ff99" stroke-width="3.375"/></pattern><pattern patternUnits="userSpaceOnUse" width="20.06" height="20.06" x="0" y="0" patternTransform="rotate(45)" id="mx-pattern-hatch-1.5-ff9999-0"><line x1="0" y1="0" x2="0" y2="20.06" stroke="#ff9999" stroke-width="3.375"/></pattern><style>@keyframes ge-flow-animation-jFvc1qBtRDd7RALEW1QK {&#xa;  to {&#xa;    stroke-dashoffset: 0;&#xa;  }&#xa;}</style><style type="text/css">@import url(https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500);&#xa;@import url(https://fonts.googleapis.com/css2?family=Architects+Daughter:wght@400;500);&#xa;@import url(https://fonts.googleapis.com/css2?family=Architects+Daughter:wght@400;500);&#xa;</style></defs><rect fill="#FAFAFA" width="100%" height="100%" x="0" y="0"/><g><g/><g><rect x="1143" y="124.5" width="391.5" height="816" rx="11.75" ry="11.75" fill="url(#mx-pattern-hatch-1.5-3399ff-0)" stroke="none" pointer-events="all"/></g><g><rect x="1141.5" y="918" width="711" height="682.5" rx="13.65" ry="13.65" fill="url(#mx-pattern-hatch-1.5-99ccff-0)" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe center; width: 455px; height: 1px; padding-top: 1058px; margin-left: 779px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font face="Roboto Mono" data-font-src="https://fonts.googleapis.com/css?family=Roboto+Mono"><i style="background-color: rgb(153, 204, 255);"><b>request main loop</b></i></font></div></div></div></foreignObject><text x="1007" y="1058" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">request main loop</text></switch></g></g><g><rect x="1201.5" y="805.5" width="333" height="681" rx="26.64" ry="26.64" fill="url(#mx-pattern-hatch-1.5-99ff99-0)" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe center; width: 220px; height: 1px; padding-top: 949px; margin-left: 802px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font face="Roboto Mono" data-font-src="https://fonts.googleapis.com/css?family=Roboto+Mono"><i style="background-color: rgb(153, 255, 153);"><b>response stream loop</b></i></font></div></div></div></foreignObject><text x="912" y="949" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">response stream loop</text></switch></g></g><g><rect x="1261.5" y="807" width="273" height="358.5" rx="21.84" ry="21.84" fill="url(#mx-pattern-hatch-1.5-ff9999-0)" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 180px; height: 1px; padding-top: 561px; margin-left: 842px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><i style=""><font face="Roboto Mono" data-font-src="https://fonts.googleapis.com/css?family=Roboto+Mono" style="background-color: rgb(255, 153, 153);"><b>line accumulator loop</b></font></i></div></div></div></foreignObject><text x="932" y="573" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">line accumulator loop</text></switch></g></g><g><path d="M 24 174 L 994.5 174 L 1020 199.5 L 1020 1603.5 L 24 1603.5 L 24 174 Z" fill="#fff2cc" stroke="#d6b656" stroke-width="1.5" stroke-miterlimit="10" pointer-events="all"/><path d="M 994.5 174 L 994.5 199.5 L 1020 199.5" fill="none" stroke="#d6b656" stroke-width="1.5" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 662px; height: 1px; padding-top: 141px; margin-left: 17px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><b><font style="font-size: 16px;">Notes</font></b></div></div></div></foreignObject><text x="348" y="152" fill="rgb(0, 0, 0)" font-family="IBM Plex Sans" font-size="11px" text-anchor="middle">Notes</text></switch></g></g><g><path d="M 60 79.5 L 90 79.5 L 81 79.5 L 98.65 79.5" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 107.65 79.5 L 95.65 83.5 L 98.65 79.5 L 95.65 75.5 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><ellipse cx="37.5" cy="79.5" rx="22.5" ry="22.5" fill="#394a63" stroke="#394a63" stroke-width="1.5" pointer-events="all"/></g><g><path d="M 321 79.5 L 351 79.5 L 327 79.5 L 344.65 79.5" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 353.65 79.5 L 341.65 83.5 L 344.65 79.5 L 341.65 75.5 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="111" y="28.5" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 53px; margin-left: 75px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Get the monthly partition key</div></div></div></foreignObject><text x="144" y="57" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Get the monthly partiti...</text></switch></g></g><g><path d="M 567 79.5 L 597 79.5 L 573 79.5 L 590.65 79.5" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 599.65 79.5 L 587.65 83.5 L 590.65 79.5 L 587.65 75.5 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="357" y="28.5" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 53px; margin-left: 239px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Create directory and file name for saving the file</div></div></div></foreignObject><text x="308" y="57" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Create directory and fi...</text></switch></g></g><g><path d="M 813 79.5 L 843 79.5 L 816 79.5 L 833.65 79.5" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 842.65 79.5 L 830.65 83.5 L 833.65 79.5 L 830.65 75.5 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="603" y="28.5" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 53px; margin-left: 403px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Construct API request</div></div></div></foreignObject><text x="472" y="57" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Construct API request</text></switch></g></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 23px; margin-left: 538px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">1</div></div></div></div></foreignObject><text x="538" y="23" fill="black" font-family="Arial,Helvetica" font-size="12px">1</text></switch></g></g><g><path d="M 1056 79.5 L 1071 79.5 Q 1086 79.5 1086 94.5 L 1086 381.75 Q 1086 396.75 1094.82 396.75 L 1103.65 396.75" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1112.65 396.75 L 1100.65 400.75 L 1103.65 396.75 L 1100.65 392.75 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="846" y="28.5" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 53px; margin-left: 565px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Start the request loop</div></div></div></foreignObject><text x="634" y="57" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Start the request loop</text></switch></g></g><g><path d="M 1561.5 123 L 1871.65 123" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1880.65 123 L 1868.65 127 L 1871.65 123 L 1868.65 119 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 69px; margin-left: 1143px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[loop flag = False]</div></div></div></foreignObject><text x="1143" y="72" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[loop flag = False]</text></switch></g></g><g><path d="M 1536.75 147.75 L 1536.75 177.75 L 1536.35 191.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536.1 200.65 L 1532.44 188.54 L 1536.35 191.65 L 1540.44 188.77 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 108px; margin-left: 973px;"><div data-drawio-colors="color: #394A63; background-color: #f5f5f5; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(245, 245, 245); white-space: nowrap;"><span style="">[loop flag = True]</span></div></div></div></foreignObject><text x="973" y="111" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[loop flag = True]</text></switch></g></g><g><path d="M 1524.38 110.63 L 1531.45 103.55 Q 1536.75 98.25 1542.05 103.55 L 1556.2 117.7 Q 1561.5 123 1556.2 128.3 L 1542.05 142.45 Q 1536.75 147.75 1531.45 142.45 L 1517.3 128.3 Q 1512 123 1517.3 117.7 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="4.5" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1989 174 L 1989 248.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1989 257.65 L 1985 245.65 L 1989 248.65 L 1993 245.65 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1884" y="72" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 82px; margin-left: 1257px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">End request loop and return download metadata</div></div></div></foreignObject><text x="1326" y="86" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">End request loop and re...</text></switch></g></g><g><path d="M 1536 462 L 1536 492 L 1536.4 505.9" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536.65 514.9 L 1532.31 503.02 L 1536.4 505.9 L 1540.31 502.79 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1431" y="360" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 274px; margin-left: 955px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Read response</div></div></div></foreignObject><text x="1024" y="278" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Read response</text></switch></g></g><g><path d="M 1561.5 543 L 1871.65 543" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1880.65 543 L 1868.65 547 L 1871.65 543 L 1868.65 539 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 343px; margin-left: 1132px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[response is empty ("[]")]</div></div></div></foreignObject><text x="1132" y="354" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[response is empty ("[]")]</text></switch></g></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 340px; margin-left: 1128px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">2</div></div></div></div></foreignObject><text x="1128" y="340" fill="black" font-family="Arial,Helvetica" font-size="12px">2</text></switch></g></g><g><path d="M 1536.75 567.75 L 1536.75 582.75 Q 1536.75 597.75 1536.75 595.87 L 1536.75 594.94 Q 1536.75 594 1536.75 602.82 L 1536.75 611.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536.75 620.65 L 1532.75 608.65 L 1536.75 611.65 L 1540.75 608.65 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 392px; margin-left: 968px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[response is a<div>non-empty JSON]</div></div></div></div></foreignObject><text x="968" y="396" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[response is a...</text></switch></g></g><g><path d="M 1524.38 530.63 L 1531.45 523.55 Q 1536.75 518.25 1542.05 523.55 L 1556.2 537.7 Q 1561.5 543 1556.2 548.3 L 1542.05 562.45 Q 1536.75 567.75 1531.45 562.45 L 1517.3 548.3 Q 1512 543 1517.3 537.7 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="4.5" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 2094 543 L 2313 543 Q 2328 543 2328 528 L 2328 40.5 Q 2328 25.5 2313 25.5 L 1102.5 25.5 Q 1087.5 25.5 1087.5 40.5 L 1087.5 382.5 Q 1087.5 397.5 1095.57 397.5 L 1103.65 397.5" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1112.65 397.5 L 1100.65 401.5 L 1103.65 397.5 L 1100.65 393.5 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1884" y="492" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 362px; margin-left: 1257px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Set loop flag to False to end stream download loop</div></div></div></foreignObject><text x="1326" y="366" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Set loop flag to False...</text></switch></g></g><g><path d="M 1536 1095 L 1536 1125 L 1536.29 1132.9" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536.63 1141.9 L 1532.18 1130.05 L 1536.29 1132.9 L 1540.18 1129.76 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1431" y="993" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 696px; margin-left: 955px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Clean the received<div>JSON line and add it to the line accumulator</div></div></div></div></foreignObject><text x="1024" y="700" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Clean the received...</text></switch></g></g><g><path d="M 1536.75 1194.75 L 1536.75 1234.88 L 1536.23 1262.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536.06 1271.65 L 1532.29 1259.57 L 1536.23 1262.65 L 1540.29 1259.72 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 814px; margin-left: 945px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[accumulated lines <span style="">= line limit]</span></div></div></div></foreignObject><text x="945" y="817" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[accumulated lines = line limit]</text></switch></g></g><g><path d="M 1512 1170 L 1512 1168.5 Q 1512 1167 1497 1167 L 1275 1167 Q 1260 1167 1260 1152 L 1260 820.5 Q 1260 805.5 1275 805.5 L 1499.65 805.5" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1508.65 805.5 L 1496.65 809.5 L 1499.65 805.5 L 1496.65 801.5 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 759px; margin-left: 929px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[accumulated lines &lt; line limit]</div></div></div></foreignObject><text x="929" y="770" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[accumulated lines &lt; line limit]</text></switch></g></g><g><path d="M 1524.38 1157.63 L 1531.45 1150.55 Q 1536.75 1145.25 1542.05 1150.55 L 1556.2 1164.7 Q 1561.5 1170 1556.2 1175.3 L 1542.05 1189.45 Q 1536.75 1194.75 1531.45 1189.45 L 1517.3 1175.3 Q 1512 1170 1517.3 1164.7 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="4.5" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1536 1377 L 1536 1424.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536 1433.65 L 1532 1421.65 L 1536 1424.65 L 1540 1421.65 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1431" y="1275" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 884px; margin-left: 955px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Save/append the accumulated lines to the CSV file</div></div></div></foreignObject><text x="1024" y="888" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Save/append the accumul...</text></switch></g></g><g><path d="M 1431 1488 L 1215 1488 Q 1200 1488 1200 1473 L 1200 820.5 Q 1200 805.5 1215 805.5 L 1499.7 805.45" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1508.7 805.44 L 1496.7 809.45 L 1499.7 805.45 L 1496.69 801.45 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1431" y="1437" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 992px; margin-left: 955px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Reset/clear the line accumulator for the next set of lines</div></div></div></foreignObject><text x="1024" y="996" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Reset/clear the line ac...</text></switch></g></g><g><path d="M 2151 966 L 2151 1013.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2151 1022.65 L 2147 1010.65 L 2151 1013.65 L 2155 1010.65 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="2046" y="864" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 610px; margin-left: 1365px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Save/append the accumulated lines to the CSV file</div></div></div></foreignObject><text x="1434" y="614" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Save/append the accumul...</text></switch></g></g><g><path d="M 2151 1128 L 2151 1181.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2151 1190.65 L 2147 1178.65 L 2151 1181.65 L 2155 1178.65 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="2046" y="1026" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 718px; margin-left: 1365px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Save/append the accumulated lines to the CSV file</div></div></div></foreignObject><text x="1434" y="722" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Save/append the accumul...</text></switch></g></g><g><path d="M 2256 1245 L 2313 1245 Q 2328 1245 2328 1230 L 2328 40.5 Q 2328 25.5 2313 25.5 L 1102.5 25.5 Q 1087.5 25.5 1087.5 40.5 L 1087.5 381 Q 1087.5 396 1102.5 396 L 1125.75 396 Q 1140.75 396 1140.75 390.18 L 1140.75 384.35" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1140.75 375.35 L 1144.75 387.35 L 1140.75 384.35 L 1136.75 387.35 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="2046" y="1194" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 830px; margin-left: 1365px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Set the loop flag to False</div></div></div></foreignObject><text x="1434" y="834" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Set the loop flag to Fa...</text></switch></g></g><g><path d="M 1140.75 372 L 1140.75 138 Q 1140.75 123 1155.75 123 L 1499.65 123" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1508.65 123 L 1496.65 127 L 1499.65 123 L 1496.65 119 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1128.38 384.38 L 1135.45 377.3 Q 1140.75 372 1146.05 377.3 L 1160.2 391.45 Q 1165.5 396.75 1160.2 402.05 L 1146.05 416.2 Q 1140.75 421.5 1135.45 416.2 L 1121.3 402.05 Q 1116 396.75 1121.3 391.45 Z" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1536 306 L 1536 321 Q 1536 336 1536 333 L 1536 331.5 Q 1536 330 1536 338.82 L 1536 347.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536 356.65 L 1532 344.65 L 1536 347.65 L 1540 344.65 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1431" y="204" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 170px; margin-left: 955px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Send API request</div></div></div></foreignObject><text x="1024" y="174" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Send API request</text></switch></g></g><g><path d="M 1536.75 940.5 L 1536.75 955.5 Q 1536.75 970.5 1536.58 975.58 L 1536.41 980.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536.11 989.65 L 1532.51 977.52 L 1536.41 980.65 L 1540.51 977.79 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 641px; margin-left: 948px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[response is still streaming<br />JSON lines]</div></div></div></foreignObject><text x="948" y="644" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[response is still streaming...</text></switch></g></g><g><path d="M 1561.5 915.75 L 1817.65 915.75" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1826.65 915.75 L 1814.65 919.75 L 1817.65 915.75 L 1814.65 911.75 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 576px; margin-left: 1120px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[end of JSON<div>response reached]</div></div></div></div></foreignObject><text x="1120" y="587" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[end of JSON...</text></switch></g></g><g><path d="M 1524.38 903.38 L 1531.45 896.3 Q 1536.75 891 1542.05 896.3 L 1556.2 910.45 Q 1561.5 915.75 1556.2 921.05 L 1542.05 935.2 Q 1536.75 940.5 1531.45 935.2 L 1517.3 921.05 Q 1512 915.75 1517.3 910.45 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="4.5" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1536.75 726 L 1536.75 741 Q 1536.75 756 1536.75 753 L 1536.75 751.5 Q 1536.75 750 1536.75 758.82 L 1536.75 767.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536.75 776.65 L 1532.75 764.65 L 1536.75 767.65 L 1540.75 764.65 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1351.5" y="624" width="370.5" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 245px; height: 1px; padding-top: 450px; margin-left: 902px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Initialize the line accumulator and line limit<div>and stream the JSON response by line</div></div></div></div></foreignObject><text x="1025" y="454" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Initialize the line accumulator and line...</text></switch></g></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 420px; margin-left: 1144px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">3</div></div></div></div></foreignObject><text x="1144" y="420" fill="black" font-family="Arial,Helvetica" font-size="12px">3</text></switch></g></g><g><path d="M 1536.75 829.5 L 1536.75 878.65" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1536.75 887.65 L 1532.75 875.65 L 1536.75 878.65 L 1540.75 875.65 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1524.38 792.38 L 1531.45 785.3 Q 1536.75 780 1542.05 785.3 L 1556.2 799.45 Q 1561.5 804.75 1556.2 810.05 L 1542.05 824.2 Q 1536.75 829.5 1531.45 824.2 L 1517.3 810.05 Q 1512 804.75 1517.3 799.45 Z" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" stroke-miterlimit="10" pointer-events="all"/></g><g><ellipse cx="1989" cy="283.5" rx="16.5" ry="16.5" fill="#394a63" stroke="#394a63" stroke-width="1.5" pointer-events="all"/><ellipse cx="1989" cy="283.5" rx="22.5" ry="22.5" fill="none" stroke="#394a63" stroke-width="1.5" pointer-events="all"/></g><g><path d="M 1854.36 1212 L 1854.37 1587 Q 1854.37 1602 1839.37 1602 L 1155 1602 Q 1140 1602 1140 1587 L 1140 531 Q 1140 516 1140.06 501 L 1140.31 432.35" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1140.35 423.35 L 1144.3 435.37 L 1140.31 432.35 L 1136.3 435.34 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1879.5 915.75 L 1947.75 915.75 Q 1962.75 915.75 1977.75 915.61 L 2033.65 915.11" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2042.65 915.03 L 2030.68 919.14 L 2033.65 915.11 L 2030.61 911.14 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 576px; margin-left: 1303px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[line accumulator<div>is not empty]</div></div></div></div></foreignObject><text x="1303" y="587" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[line accumulator...</text></switch></g></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 573px; margin-left: 1298px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">4</div></div></div></div></foreignObject><text x="1298" y="573" fill="black" font-family="Arial,Helvetica" font-size="12px">4</text></switch></g></g><g><path d="M 1854.75 940.5 L 1854.75 1099.15" fill="none" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 1854.75 1108.15 L 1850.75 1096.15 L 1854.75 1099.15 L 1858.75 1096.15 Z" fill="#556f94" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 673px; margin-left: 1189px;"><div data-drawio-colors="color: #394A63; background-color: #f5f5f5; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(245, 245, 245); white-space: nowrap;">[line accumulator<div>is empty]</div></div></div></div></foreignObject><text x="1189" y="684" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[line accumulator...</text></switch></g></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 670px; margin-left: 1185px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">5</div></div></div></div></foreignObject><text x="1185" y="670" fill="black" font-family="Arial,Helvetica" font-size="12px">5</text></switch></g></g><g><path d="M 1842.38 903.38 L 1849.45 896.3 Q 1854.75 891 1860.05 896.3 L 1874.2 910.45 Q 1879.5 915.75 1874.2 921.05 L 1860.05 935.2 Q 1854.75 940.5 1849.45 935.2 L 1835.3 921.05 Q 1830 915.75 1835.3 910.45 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="4.5" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1749.75" y="1111.5" width="210" height="102" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="4.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 775px; margin-left: 1168px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">offset += request limit</div></div></div></foreignObject><text x="1237" y="779" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">offset += request limit</text></switch></g></g><g/><g><rect x="87.16" y="756" width="881.84" height="382.5" rx="34.42" ry="34.42" fill="#f5f5f5" stroke="#666666" stroke-width="1.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 632px; margin-left: 76px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>To process the non-empty JSON response, we initialize a <b>line accumulator</b> and a <b>line limit. </b>The line accumulator is simply a list that collects the cleaned JSON lines we receive from the stream, while the line limit is the max number of JSON lines we will store in the line accumulator (set to 100k). <span style="background-color: initial;">When the line limit is reached, we save the accumulated JSON lines as CSV. (see <i><b>line accumulator loop</b></i>)</span></div><div><span style="background-color: initial;"><br /></span></div><div><span style="background-color: initial;">Technically, we could have just streamed the whole response body (the JSON response) instead of batch saving it. However, I felt that batch saving is a more efficient option for the following reason:</span></div><div><ol style="margin-top: 5px; margin-bottom: 5px;"><li>Since the streamed lines are saved in the memory, batch saving will reduce memory usage. This is particularly helpful in my case considering I am using Dagster to make multiple requests to fetch the different partitions of the dataset</li><li>As each JSON line is received, we can immediately perform initial data cleaning and transformation to before saving the lines instead of doing these processes after we have downloaded them.</li><li> Although not yet implemented, we could implement resumable downloads in the case the stream gets cut abruptly by using the number of records we have downloaded so far and using it along with offset to resume our download</li></ol><div>In short, stream downloading + batch saving = efficient and memory-friendly 💙</div></div></div></div></div></foreignObject><text x="76" y="635" fill="#333333" font-family="IBM Plex Sans" font-size="11px">To process the non-empty JSON response, we initialize a line accumulator and a line limit. The line ac...</text></switch></g></g><g><rect x="75" y="924.47" width="30.41" height="45.56" rx="4.56" ry="4.56" fill="#ffff00" stroke="#808080" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 632px; margin-left: 51px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">3</div></div></div></foreignObject><text x="60" y="635" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">3</text></switch></g></g><g/><g><rect x="87.16" y="1149" width="881.84" height="193.5" rx="17.41" ry="17.41" fill="#f5f5f5" stroke="#666666" stroke-width="1.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 831px; margin-left: 76px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">When the end of response is reached we need to check if the line accumulator is empty to determine if we should continue the main request loop. If it is empty, this implies that:<ol style="margin-top: 5px; margin-bottom: 5px;"><li>There are exactly 500k rows for our request</li><li>There are more than 500k rows for our request, and the server limited the response we have indicated</li></ol><div>We can only verify that there are still more records to fetch by sending another request with the next offset:</div><div><ol style="margin-top: 5px; margin-bottom: 0px;"><li>If #1 is true, we will receive an empty response and we terminate the request loop (as per Note #2)<br /></li><li>If #2 is true, we continue stream downloading the response until we receive the condition in Note #5</li></ol></div><div><span style="color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-wrap: nowrap; background-color: initial;">%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%22%20style%3D%22group%3Bautosize%3D1%3BresizeHeight%3D0%3BtreeFolding%3D0%3Bcomic%3D0%3Bcontainer%3D0%3BfixDash%3D0%3BallowArrows%3D0%3BnoLabel%3D0%3Boverflow%3Dvisible%3B%22%20vertex%3D%221%22%20connectable%3D%220%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%2267%22%20y%3D%22184%22%20width%3D%22596%22%20height%3D%22148%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3CmxCell%20id%3D%223%22%20value%3D%22We%20limit%20the%20response%20of%20each%20request%20to%20only%20return%20500k%20records%20at%20most%20(the%20%26lt%3Bb%26gt%3Bresponse%20limit%26lt%3B%2Fb%26gt%3B)%20to%20avoid%20large%20payloads%20that%20could%20negatively%20affect%20the%20processing%20of%20our%20request.%20During%20my%20crude%20testing%2C%20I%20would%20always%20encounter%20a%20server%20timeout%20error%20when%20my%20request%20doesn't%20have%20a%20limit.%20The%20500k%20limit%20seems%20to%20work%20fine%2C%20but%20I%20am%20yet%20to%20do%20rigorous%20tests%20to%20determine%20the%20optimal%20limit%20that%20would%20balance%20the%20server%20resources%2C%20my%20internet%20connection%2C%20and%20my%20RAM%26amp%3Bnbsp%3B%26amp%3Bnbsp%3B%26lt%3Bspan%20style%3D%26quot%3Bbackground-color%3A%20initial%3B%26quot%3B%26gt%3B%F0%9F%98%85%26lt%3B%2Fspan%26gt%3B%26lt%3Bdiv%26gt%3B%26lt%3Bbr%26gt%3B%26lt%3B%2Fdiv%26gt%3B%26lt%3Bdiv%26gt%3BSince%20the%20total%20records%20from%20our%20request%20will%20exceed%20this%20limit%2C%20we%20create%20a%20request%20loop%20that%20will%20continuously%20send%20our%20request%20to%20the%20server%20until%20all%20the%20records%20for%20our%20request%20has%20been%20exhausted.%26amp%3Bnbsp%3B%26lt%3Bspan%20style%3D%26quot%3Bbackground-color%3A%20initial%3B%26quot%3B%26gt%3BTo%20retrieve%20the%20next%20set%20of%20records%2C%20the%20request%20also%20includes%20an%20'%26lt%3B%2Fspan%26gt%3B%26lt%3Bb%20style%3D%26quot%3Bbackground-color%3A%20initial%3B%26quot%3B%26gt%3Boffset%26lt%3B%2Fb%26gt%3B%26lt%3Bspan%20style%3D%26quot%3Bbackground-color%3A%20initial%3B%26quot%3B%26gt%3B'%20parameter%20that%20is%20incremented%20by%20the%20response%20limit%20each%20time%20we%20send%20a%20new%20request%20to%20the%20server%2C%26lt%3B%2Fspan%26gt%3B%26lt%3B%2Fdiv%26gt%3B%22%20style%3D%22rounded%3D1%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3Balign%3Dleft%3BverticalAlign%3Dmiddle%3BfontFamily%3DIBM%20Plex%20Sans%3BfontSize%3D11%3BlabelBackgroundColor%3Dnone%3BspacingLeft%3D16%3BstrokeWidth%3D1%3BfillColor%3D%23f5f5f5%3BfontColor%3D%23333333%3BstrokeColor%3D%23666666%3BarcSize%3D9%3BspacingRight%3D8%3B%22%20vertex%3D%221%22%20parent%3D%222%22%3E%3CmxGeometry%20x%3D%228.11%22%20width%3D%22587.89%22%20height%3D%22148%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3CmxCell%20id%3D%224%22%20value%3D%221%22%20style%3D%22rounded%3D1%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3BfontFamily%3DHelvetica%3BfontSize%3D12%3BlabelBackgroundColor%3Dnone%3BfillColor%3D%23ffff00%3BstrokeColor%3D%23808080%3BstrokeWidth%3D2%3BfontStyle%3D1%3BallowArrows%3D0%3Bconnectable%3D0%3B%22%20vertex%3D%221%22%20parent%3D%222%22%3E%3CmxGeometry%20y%3D%2238.8125%22%20width%3D%2220.272108843537417%22%20height%3D%2230.375%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E</span></div></div></div></div></foreignObject><text x="76" y="834" fill="#333333" font-family="IBM Plex Sans" font-size="11px">When the end of response is reached we need to check if the line accumulator is empty to determine if...</text></switch></g></g><g><rect x="75" y="1237.22" width="30.41" height="45.56" rx="4.56" ry="4.56" fill="#ffff00" stroke="#808080" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 840px; margin-left: 51px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">4</div></div></div></foreignObject><text x="60" y="844" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">4</text></switch></g></g><g/><g><rect x="87.16" y="246" width="881.84" height="222" rx="19.98" ry="19.98" fill="#f5f5f5" stroke="#666666" stroke-width="1.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 238px; margin-left: 76px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">We limit the response of each request to only return 500k records at most (the <b>response limit</b>) to avoid large payloads that could negatively affect the processing of our request. During my crude testing, I would always encounter a server timeout error when my request doesn't have a limit. The 500k limit seems to work fine, but I am yet to do rigorous tests to determine the optimal limit that would balance the server resources, my internet connection, and my RAM  <span style="background-color: initial;">😅</span><div><br /></div><div>Since the total records from our request will exceed this limit, we create a request loop that will continuously send our request to the server until all the records for our request has been exhausted. <span style="background-color: initial;">To retrieve the next set of records, the request also includes an '</span><b style="background-color: initial;">offset</b><span style="background-color: initial;">' parameter that is incremented by the response limit each time we send a new request to the server,</span></div></div></div></div></foreignObject><text x="76" y="241" fill="#333333" font-family="IBM Plex Sans" font-size="11px">We limit the response of each request to only return 500k records at most (the response limit) to avoi...</text></switch></g></g><g><rect x="75" y="334.22" width="30.41" height="45.56" rx="4.56" ry="4.56" fill="#ffff00" stroke="#808080" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 238px; margin-left: 51px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">1</div></div></div></foreignObject><text x="60" y="242" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">1</text></switch></g></g><g/><g><rect x="87.16" y="477" width="881.84" height="270" rx="24.3" ry="24.3" fill="#f5f5f5" stroke="#666666" stroke-width="1.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 408px; margin-left: 76px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>When the response received is an empty JSON, in general, this could mean a couple of things:</div><div><ol style="padding-left: 30px; margin-top: 5px; margin-bottom: 5px;"><li>We made a logical error in our request parameters. The query is syntactically correct but the logic is flawed</li><li>No logical error but there are no records that correspond to our request query</li><li>Request with the latest offset is empty, which means that we have exhausted all the records for our request</li></ol><div>For our request logic, the above conditions *should* not be met for the following reason:</div></div><div><ol style="padding-left: 30px; margin-top: 5px; margin-bottom: 0px;"><li>Our request is fairly simple as we are just retrieving all the taxi trip records within the particular month indicated in our request (WHERE pickup_dtime &gt;= month_start AND pickup_dtime &lt; next_month_start)</li><li>We are guaranteed to have at least one (1) record for our request</li><li>Every request in the request loop is guaranteed to return a record since the current logic will not send a request with an offset that exceeds the total record for our request. However, there is an exception to this as discussed in Notes #4 and #5</li></ol></div><div><br /></div></div></div></div></foreignObject><text x="76" y="411" fill="#333333" font-family="IBM Plex Sans" font-size="11px">When the response received is an empty JSON, in general, this could mean a couple of things:...</text></switch></g></g><g><rect x="75" y="589.5" width="30.41" height="45" rx="4.56" ry="4.56" fill="#ffff00" stroke="#808080" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 408px; margin-left: 51px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">2</div></div></div></foreignObject><text x="60" y="412" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">2</text></switch></g></g><g/><g><rect x="87.16" y="1357.5" width="881.84" height="186" rx="16.74" ry="16.74" fill="#f5f5f5" stroke="#666666" stroke-width="1.5" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 967px; margin-left: 76px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">When the line accumulator is empty even after we have finished streaming the response of the current request, this means that <b>t</b><span style="background-color: initial;"><b>he line limit is not reached (accumulated less than 100k records), which also means the total response is less than than our request limit of 500k records.</b></span><div><span style="background-color: initial;"><b><br /></b></span></div><div><span style="background-color: initial;">When this condition is met,<b> we end our request loop</b> since there are no more data to fetch. However, <b>this only works when the request limit is divisible by the line limit. </b>Otherwise, our request loop will prematurely end after the first request <b>since the last batch of lines that will be accumulated will always be less than the line limit</b>, triggering this condition.</span></div></div></div></div></foreignObject><text x="76" y="970" fill="#333333" font-family="IBM Plex Sans" font-size="11px">When the line accumulator is empty even after we have finished streaming the response of the current r...</text></switch></g></g><g><rect x="75" y="1427.72" width="30.41" height="45.56" rx="4.56" ry="4.56" fill="#ffff00" stroke="#808080" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 967px; margin-left: 51px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">5</div></div></div></foreignObject><text x="60" y="971" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">5</text></switch></g></g><g><rect x="402" y="1638" width="1540.5" height="105" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1127px; margin-left: 782px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Architects Daughter&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: nowrap;"><font size="1" face="IBM Plex Sans"><b style="font-size: 48px;">Stream Downloading the API Response Body</b></font></div></div></div></foreignObject><text x="782" y="1131" fill="#384b63" font-family="Architects Daughter" font-size="12px" text-anchor="middle">Stream Downloading the API Response Body</text></switch></g></g><g><rect x="1987.5" y="1360.5" width="260.83" height="243" fill="#f5f5f5" stroke="none" pointer-events="all"/></g><g/><g><ellipse cx="2033.67" cy="1403.75" rx="7.290000000000001" ry="7.290000000000001" fill="#394a63" stroke="#394a63" stroke-width="1.5" pointer-events="all"/></g><g><rect x="2052.62" y="1388.69" width="147.74" height="30.13" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 936px; margin-left: 1370px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Initial node</div></div></div></foreignObject><text x="1370" y="938" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Initial node</text></switch></g></g><g/><g><rect x="1987.5" y="1422.22" width="54.43" height="27.22" rx="7.5" ry="7.5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 34px; height: 1px; padding-top: 957px; margin-left: 1326px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 8px;">Action</font></div></div></div></foreignObject><text x="1343" y="961" fill="#384b63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Action</text></switch></g></g><g><rect x="2053.6" y="1420.76" width="147.74" height="30.13" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 957px; margin-left: 1371px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Action. 1 in, 1 out</div></div></div></foreignObject><text x="1371" y="960" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Action. 1 in, 1 out</text></switch></g></g><g/><g><path d="M 2023.71 1465.72 L 2026.74 1462.68 Q 2029.78 1459.64 2035.09 1464.95 L 2038.51 1468.37 Q 2041.93 1471.79 2036.63 1477.1 L 2033.21 1480.52 Q 2029.78 1483.94 2024.48 1478.64 L 2021.06 1475.22 Q 2017.63 1471.79 2020.67 1468.76 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="2053.6" y="1456.73" width="147.74" height="30.13" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 981px; margin-left: 1371px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Decision node. 1 in, 2+ outs</div></div></div></foreignObject><text x="1371" y="984" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Decision node. 1 in, 2+...</text></switch></g></g><g/><g><path d="M 2022.73 1498.77 L 2025.77 1495.73 Q 2028.81 1492.69 2034.11 1498 L 2037.54 1501.42 Q 2040.96 1504.84 2035.66 1510.15 L 2032.23 1513.57 Q 2028.81 1516.99 2023.51 1511.69 L 2020.08 1508.27 Q 2016.66 1504.84 2019.7 1501.8 Z" fill="#dae8fc" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="2052.62" y="1489.78" width="147.74" height="30.13" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 1003px; margin-left: 1370px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Merge node. 2+ ins, 1 out</div></div></div></foreignObject><text x="1370" y="1006" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Merge node. 2+ ins, 1 out</text></switch></g></g><g/><g><path d="M 1993.33 1531.82 L 2032.38 1531.82" fill="none" stroke="#6c8ebf" stroke-width="1.5" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2040.26 1531.82 L 2029.76 1535.32 L 2032.38 1531.82 L 2029.76 1528.32 Z" fill="#6c8ebf" stroke="#6c8ebf" stroke-width="1.5" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="2053.6" y="1516.99" width="147.74" height="30.13" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 1021px; margin-left: 1371px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Control flow</div></div></div></foreignObject><text x="1371" y="1024" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Control flow</text></switch></g></g><g/><g><path d="M 1993.33 1558.07 L 2032.38 1558.07" fill="none" stroke="#6c8ebf" stroke-width="1.5" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="12" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-jFvc1qBtRDd7RALEW1QK; stroke-dashoffset: 24;"/><path d="M 2040.26 1558.07 L 2029.76 1561.57 L 2032.38 1558.07 L 2029.76 1554.57 Z" fill="#6c8ebf" stroke="#6c8ebf" stroke-width="1.5" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="2053.6" y="1543.24" width="194.73" height="30.13" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 128px; height: 1px; padding-top: 1039px; margin-left: 1371px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Control flow w/ emphasis on the flow that will continue a loop</div></div></div></foreignObject><text x="1371" y="1041" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Control flow w/ emphasis on the...</text></switch></g></g><g/><g><ellipse cx="2034.64" cy="1588.43" rx="4.3740000000000006" ry="4.3740000000000006" fill="#394a63" stroke="#394a63" stroke-width="1.5" pointer-events="all"/><ellipse cx="2034.64" cy="1588.43" rx="7.290000000000001" ry="7.290000000000001" fill="none" stroke="#394a63" stroke-width="1.5" pointer-events="all"/></g><g><rect x="2053.6" y="1573.37" width="147.74" height="30.13" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 1059px; margin-left: 1371px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Final node</div></div></div></foreignObject><text x="1371" y="1061" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Final node</text></switch></g></g><g><rect x="2078.08" y="1360.5" width="85.5" height="39" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)scale(1.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 920px; margin-left: 1414px;"><div data-drawio-colors="color: #384b63; background-color: #FFFF00; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; font-weight: bold; background-color: rgb(255, 255, 0); white-space: nowrap;">Legend</div></div></div></foreignObject><text x="1414" y="924" fill="#384b63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle" font-weight="bold">Legend</text></switch></g></g></g></svg>