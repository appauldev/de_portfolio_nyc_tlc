<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1602px" height="1203px" viewBox="-0.5 -0.5 1602 1203" style="background-color: rgb(250, 250, 250);"><defs><pattern patternUnits="userSpaceOnUse" width="11.5" height="11.5" x="0" y="0" patternTransform="rotate(45)" id="mx-pattern-hatch-1-3399ff-0"><line x1="0" y1="0" x2="0" y2="11.5" stroke="#3399ff" stroke-width="1.5"/></pattern><pattern patternUnits="userSpaceOnUse" width="11.5" height="11.5" x="0" y="0" patternTransform="rotate(45)" id="mx-pattern-hatch-1-99ccff-0"><line x1="0" y1="0" x2="0" y2="11.5" stroke="#99ccff" stroke-width="1.5"/></pattern><pattern patternUnits="userSpaceOnUse" width="11.5" height="11.5" x="0" y="0" patternTransform="rotate(45)" id="mx-pattern-hatch-1-99ff99-0"><line x1="0" y1="0" x2="0" y2="11.5" stroke="#99ff99" stroke-width="1.5"/></pattern><pattern patternUnits="userSpaceOnUse" width="11.5" height="11.5" x="0" y="0" patternTransform="rotate(45)" id="mx-pattern-hatch-1-ff9999-0"><line x1="0" y1="0" x2="0" y2="11.5" stroke="#ff9999" stroke-width="1.5"/></pattern><style>@keyframes ge-flow-animation-g_2tIH1OXfAzrHx0g_cj {&#xa;  to {&#xa;    stroke-dashoffset: 0;&#xa;  }&#xa;}</style><style type="text/css">@import url(https://fonts.googleapis.com/css2?family=Architects+Daughter:wght@400;500);&#xa;@import url(https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500);&#xa;</style></defs><rect fill="#FAFAFA" width="100%" height="100%" x="0" y="0"/><g><g/><g><rect x="777" y="99" width="261" height="544" rx="7.83" ry="7.83" fill="url(#mx-pattern-hatch-1-3399ff-0)" stroke="none" pointer-events="all"/></g><g><rect x="776" y="628" width="474" height="455" rx="9.1" ry="9.1" fill="url(#mx-pattern-hatch-1-99ccff-0)" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe center; width: 455px; height: 1px; padding-top: 1074px; margin-left: 794px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font face="Roboto Mono" data-font-src="https://fonts.googleapis.com/css?family=Roboto+Mono"><i style="background-color: rgb(153, 204, 255);"><b>request main loop</b></i></font></div></div></div></foreignObject><text x="1022" y="1074" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">request main loop</text></switch></g></g><g><rect x="816" y="553" width="222" height="454" rx="17.76" ry="17.76" fill="url(#mx-pattern-hatch-1-99ff99-0)" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe center; width: 220px; height: 1px; padding-top: 965px; margin-left: 817px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font face="Roboto Mono" data-font-src="https://fonts.googleapis.com/css?family=Roboto+Mono"><i style="background-color: rgb(153, 255, 153);"><b>response stream loop</b></i></font></div></div></div></foreignObject><text x="927" y="965" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">response stream loop</text></switch></g></g><g><rect x="856" y="554" width="182" height="239" rx="14.56" ry="14.56" fill="url(#mx-pattern-hatch-1-ff9999-0)" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 180px; height: 1px; padding-top: 577px; margin-left: 857px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><i style=""><font face="Roboto Mono" data-font-src="https://fonts.googleapis.com/css?family=Roboto+Mono" style="background-color: rgb(255, 153, 153);"><b>line accumulator loop</b></font></i></div></div></div></foreignObject><text x="947" y="589" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">line accumulator loop</text></switch></g></g><g><path d="M 55 69 L 75 69 L 69 69 L 80.76 69" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 86.76 69 L 78.76 71.67 L 80.76 69 L 78.76 66.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><ellipse cx="40" cy="69" rx="15" ry="15" fill="#394a63" stroke="#394a63" pointer-events="all"/></g><g><path d="M 229 69 L 249 69 L 233 69 L 244.76 69" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250.76 69 L 242.76 71.67 L 244.76 69 L 242.76 66.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="89" y="35" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 69px; margin-left: 90px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Get the monthly partition key</div></div></div></foreignObject><text x="159" y="73" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Get the monthly partiti...</text></switch></g></g><g><path d="M 393 69 L 413 69 L 397 69 L 408.76 69" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 414.76 69 L 406.76 71.67 L 408.76 69 L 406.76 66.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="253" y="35" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 69px; margin-left: 254px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Create directory and file name for saving the file</div></div></div></foreignObject><text x="323" y="73" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Create directory and fi...</text></switch></g></g><g><path d="M 557 69 L 577 69 L 559 69 L 570.76 69" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 576.76 69 L 568.76 71.67 L 570.76 69 L 568.76 66.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="417" y="35" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 69px; margin-left: 418px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Construct API request</div></div></div></foreignObject><text x="487" y="73" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Construct API request</text></switch></g></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 39px; margin-left: 553px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">1</div></div></div></div></foreignObject><text x="553" y="39" fill="black" font-family="Arial,Helvetica" font-size="12px">1</text></switch></g></g><g><path d="M 719 69 L 729 69 Q 739 69 739 79 L 739 270.5 Q 739 280.5 744.88 280.5 L 750.76 280.5" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 756.76 280.5 L 748.76 283.17 L 750.76 280.5 L 748.76 277.83 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="579" y="35" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 69px; margin-left: 580px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Start the request loop</div></div></div></foreignObject><text x="649" y="73" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Start the request loop</text></switch></g></g><g><path d="M 1056 98 L 1262.76 98" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1268.76 98 L 1260.76 100.67 L 1262.76 98 L 1260.76 95.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 85px; margin-left: 1158px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[loop flag = False]</div></div></div></foreignObject><text x="1158" y="88" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[loop flag = False]</text></switch></g></g><g><path d="M 1039.5 114.5 L 1039.5 134.5 L 1039.24 143.77" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039.06 149.76 L 1036.63 141.69 L 1039.24 143.77 L 1041.96 141.84 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 124px; margin-left: 988px;"><div data-drawio-colors="color: #394A63; background-color: #f5f5f5; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(245, 245, 245); white-space: nowrap;"><span style="">[loop flag = True]</span></div></div></div></foreignObject><text x="988" y="127" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[loop flag = True]</text></switch></g></g><g><path d="M 1031.25 89.75 L 1035.96 85.04 Q 1039.5 81.5 1043.04 85.04 L 1052.46 94.46 Q 1056 98 1052.46 101.54 L 1043.04 110.96 Q 1039.5 114.5 1035.96 110.96 L 1026.54 101.54 Q 1023 98 1026.54 94.46 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1341 132 L 1341 181.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1341 187.76 L 1338.33 179.76 L 1341 181.76 L 1343.67 179.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1271" y="64" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 98px; margin-left: 1272px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">End request loop and return download metadata</div></div></div></foreignObject><text x="1341" y="102" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">End request loop and re...</text></switch></g></g><g><path d="M 1039 324 L 1039 344 L 1039.26 353.27" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039.44 359.26 L 1036.54 351.34 L 1039.26 353.27 L 1041.87 351.19 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="969" y="256" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 290px; margin-left: 970px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Read response</div></div></div></foreignObject><text x="1039" y="294" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Read response</text></switch></g></g><g><path d="M 1056 378 L 1262.76 378" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1268.76 378 L 1260.76 380.67 L 1262.76 378 L 1260.76 375.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 359px; margin-left: 1147px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[response is empty ("[]")]</div></div></div></foreignObject><text x="1147" y="370" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[response is empty ("[]")]</text></switch></g></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 356px; margin-left: 1143px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">2</div></div></div></div></foreignObject><text x="1143" y="356" fill="black" font-family="Arial,Helvetica" font-size="12px">2</text></switch></g></g><g><path d="M 1039.5 394.5 L 1039.5 404.5 Q 1039.5 414.5 1039.5 413.25 L 1039.5 412.62 Q 1039.5 412 1039.5 417.88 L 1039.5 423.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039.5 429.76 L 1036.83 421.76 L 1039.5 423.76 L 1042.17 421.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 408px; margin-left: 983px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[response is a<div>non-empty JSON]</div></div></div></div></foreignObject><text x="983" y="412" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[response is a...</text></switch></g></g><g><path d="M 1031.25 369.75 L 1035.96 365.04 Q 1039.5 361.5 1043.04 365.04 L 1052.46 374.46 Q 1056 378 1052.46 381.54 L 1043.04 390.96 Q 1039.5 394.5 1035.96 390.96 L 1026.54 381.54 Q 1023 378 1026.54 374.46 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1411 378 L 1557 378 Q 1567 378 1567 368 L 1567 43 Q 1567 33 1557 33 L 750 33 Q 740 33 740 43 L 740 271 Q 740 281 745.38 281 L 750.76 281" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 756.76 281 L 748.76 283.67 L 750.76 281 L 748.76 278.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1271" y="344" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 378px; margin-left: 1272px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Set loop flag to False to end stream download loop</div></div></div></foreignObject><text x="1341" y="382" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Set loop flag to False...</text></switch></g></g><g><path d="M 1039 746 L 1039 766 L 1039.2 771.27" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039.42 777.27 L 1036.46 769.37 L 1039.2 771.27 L 1041.79 769.17 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="969" y="678" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 712px; margin-left: 970px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Clean the received<div>JSON line and add it to the line accumulator</div></div></div></div></foreignObject><text x="1039" y="716" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Clean the received...</text></switch></g></g><g><path d="M 1039.5 812.5 L 1039.5 839.25 L 1039.15 857.77" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039.04 863.76 L 1036.53 855.72 L 1039.15 857.77 L 1041.86 855.82 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 830px; margin-left: 960px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[accumulated lines <span style="">= line limit]</span></div></div></div></foreignObject><text x="960" y="833" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[accumulated lines = line limit]</text></switch></g></g><g><path d="M 1023 796 L 1023 795 Q 1023 794 1013 794 L 865 794 Q 855 794 855 784 L 855 563 Q 855 553 865 553 L 1014.76 553" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1020.76 553 L 1012.76 555.67 L 1014.76 553 L 1012.76 550.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 775px; margin-left: 944px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[accumulated lines &lt; line limit]</div></div></div></foreignObject><text x="944" y="786" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[accumulated lines &lt; line limit]</text></switch></g></g><g><path d="M 1031.25 787.75 L 1035.96 783.04 Q 1039.5 779.5 1043.04 783.04 L 1052.46 792.46 Q 1056 796 1052.46 799.54 L 1043.04 808.96 Q 1039.5 812.5 1035.96 808.96 L 1026.54 799.54 Q 1023 796 1026.54 792.46 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1039 934 L 1039 965.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039 971.76 L 1036.33 963.76 L 1039 965.76 L 1041.67 963.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="969" y="866" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 900px; margin-left: 970px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Save/append the accumulated lines to the CSV file</div></div></div></foreignObject><text x="1039" y="904" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Save/append the accumul...</text></switch></g></g><g><path d="M 969 1008 L 825 1008 Q 815 1008 815 998 L 815 563 Q 815 553 825 553 L 1014.8 552.96" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1020.8 552.96 L 1012.8 555.63 L 1014.8 552.96 L 1012.8 550.3 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="969" y="974" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 1008px; margin-left: 970px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Reset/clear the line accumulator for the next set of lines</div></div></div></foreignObject><text x="1039" y="1012" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Reset/clear the line ac...</text></switch></g></g><g><path d="M 1449 660 L 1449 691.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1449 697.76 L 1446.33 689.76 L 1449 691.76 L 1451.67 689.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1379" y="592" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 626px; margin-left: 1380px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Save/append the accumulated lines to the CSV file</div></div></div></foreignObject><text x="1449" y="630" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Save/append the accumul...</text></switch></g></g><g><path d="M 1449 768 L 1449 803.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1449 809.76 L 1446.33 801.76 L 1449 803.76 L 1451.67 801.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1379" y="700" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 734px; margin-left: 1380px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Save/append the accumulated lines to the CSV file</div></div></div></foreignObject><text x="1449" y="738" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Save/append the accumul...</text></switch></g></g><g><path d="M 1519 846 L 1557 846 Q 1567 846 1567 836 L 1567 43 Q 1567 33 1557 33 L 750 33 Q 740 33 740 43 L 740 270 Q 740 280 750 280 L 765.5 280 Q 775.5 280 775.5 276.12 L 775.5 272.24" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 775.5 266.24 L 778.17 274.24 L 775.5 272.24 L 772.83 274.24 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1379" y="812" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 846px; margin-left: 1380px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Set the loop flag to False</div></div></div></foreignObject><text x="1449" y="850" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Set the loop flag to Fa...</text></switch></g></g><g><path d="M 775.5 264 L 775.5 108 Q 775.5 98 785.5 98 L 1014.76 98" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1020.76 98 L 1012.76 100.67 L 1014.76 98 L 1012.76 95.33 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 767.25 272.25 L 771.96 267.54 Q 775.5 264 779.04 267.54 L 788.46 276.96 Q 792 280.5 788.46 284.04 L 779.04 293.46 Q 775.5 297 771.96 293.46 L 762.54 284.04 Q 759 280.5 762.54 276.96 Z" fill="#dae8fc" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1039 220 L 1039 230 Q 1039 240 1039 238 L 1039 237 Q 1039 236 1039 241.88 L 1039 247.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039 253.76 L 1036.33 245.76 L 1039 247.76 L 1041.67 245.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="969" y="152" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 186px; margin-left: 970px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Send API request</div></div></div></foreignObject><text x="1039" y="190" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Send API request</text></switch></g></g><g><path d="M 1039.5 643 L 1039.5 653 Q 1039.5 663 1039.39 666.38 L 1039.27 669.77" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039.07 675.77 L 1036.68 667.68 L 1039.27 669.77 L 1042.01 667.86 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 657px; margin-left: 963px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[response is still streaming<br />JSON lines]</div></div></div></foreignObject><text x="963" y="660" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[response is still streaming...</text></switch></g></g><g><path d="M 1056 626.5 L 1226.76 626.5" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1232.76 626.5 L 1224.76 629.17 L 1226.76 626.5 L 1224.76 623.83 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 592px; margin-left: 1135px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[end of JSON<div>response reached]</div></div></div></div></foreignObject><text x="1135" y="603" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[end of JSON...</text></switch></g></g><g><path d="M 1031.25 618.25 L 1035.96 613.54 Q 1039.5 610 1043.04 613.54 L 1052.46 622.96 Q 1056 626.5 1052.46 630.04 L 1043.04 639.46 Q 1039.5 643 1035.96 639.46 L 1026.54 630.04 Q 1023 626.5 1026.54 622.96 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1039.5 500 L 1039.5 510 Q 1039.5 520 1039.5 518 L 1039.5 517 Q 1039.5 516 1039.5 521.88 L 1039.5 527.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039.5 533.76 L 1036.83 525.76 L 1039.5 527.76 L 1042.17 525.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="916" y="432" width="247" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 245px; height: 1px; padding-top: 466px; margin-left: 917px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Initialize the line accumulator and line limit<div>and stream the JSON response by line</div></div></div></div></foreignObject><text x="1040" y="470" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Initialize the line accumulator and line...</text></switch></g></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 436px; margin-left: 1159px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">3</div></div></div></div></foreignObject><text x="1159" y="436" fill="black" font-family="Arial,Helvetica" font-size="12px">3</text></switch></g></g><g><path d="M 1039.5 569 L 1039.5 601.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1039.5 607.76 L 1036.83 599.76 L 1039.5 601.76 L 1042.17 599.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1031.25 544.25 L 1035.96 539.54 Q 1039.5 536 1043.04 539.54 L 1052.46 548.96 Q 1056 552.5 1052.46 556.04 L 1043.04 565.46 Q 1039.5 569 1035.96 565.46 L 1026.54 556.04 Q 1023 552.5 1026.54 548.96 Z" fill="#dae8fc" stroke="#556f94" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><ellipse cx="1341" cy="205" rx="11" ry="11" fill="#394a63" stroke="#394a63" pointer-events="all"/><ellipse cx="1341" cy="205" rx="15" ry="15" fill="none" stroke="#394a63" pointer-events="all"/></g><g><path d="M 1251.24 824 L 1251.25 1074 Q 1251.25 1084 1241.25 1084 L 785 1084 Q 775 1084 775 1074 L 775 370 Q 775 360 775.04 350 L 775.21 304.24" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 775.23 298.24 L 777.87 306.25 L 775.21 304.24 L 772.53 306.23 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1268 626.5 L 1313.5 626.5 Q 1323.5 626.5 1333.5 626.41 L 1370.76 626.07" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1376.76 626.02 L 1368.79 628.76 L 1370.76 626.07 L 1368.74 623.43 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 592px; margin-left: 1318px;"><div data-drawio-colors="color: #394A63; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">[line accumulator<div>is not empty]</div></div></div></div></foreignObject><text x="1318" y="603" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[line accumulator...</text></switch></g></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 589px; margin-left: 1313px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">4</div></div></div></div></foreignObject><text x="1313" y="589" fill="black" font-family="Arial,Helvetica" font-size="12px">4</text></switch></g></g><g><path d="M 1251.5 643 L 1251.5 748.76" fill="none" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1251.5 754.76 L 1248.83 746.76 L 1251.5 748.76 L 1254.17 746.76 Z" fill="#556f94" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 689px; margin-left: 1204px;"><div data-drawio-colors="color: #394A63; background-color: #f5f5f5; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; background-color: rgb(245, 245, 245); white-space: nowrap;">[line accumulator<div>is empty]</div></div></div></div></foreignObject><text x="1204" y="700" fill="#394A63" font-family="Helvetica" font-size="11px" text-anchor="middle">[line accumulator...</text></switch></g></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 686px; margin-left: 1200px;"><div data-drawio-colors="color: black; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Arial, Helvetica; color: black; line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="padding:2px;border:1px solid gray;background:yellow;border-radius:2px;">5</div></div></div></div></foreignObject><text x="1200" y="686" fill="black" font-family="Arial,Helvetica" font-size="12px">5</text></switch></g></g><g><path d="M 1243.25 618.25 L 1247.96 613.54 Q 1251.5 610 1255.04 613.54 L 1264.46 622.96 Q 1268 626.5 1264.46 630.04 L 1255.04 639.46 Q 1251.5 643 1247.96 639.46 L 1238.54 630.04 Q 1235 626.5 1238.54 622.96 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="1181.5" y="757" width="140" height="68" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="3" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 791px; margin-left: 1183px;"><div data-drawio-colors="color: #394A63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(57, 74, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">offset += request limit</div></div></div></foreignObject><text x="1252" y="795" fill="#394A63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">offset += request limit</text></switch></g></g><g><path d="M 31 132 L 678 132 L 695 149 L 695 1085 L 31 1085 L 31 132 Z" fill="#fff2cc" stroke="#d6b656" stroke-miterlimit="10" pointer-events="all"/><path d="M 678 132 L 678 149 L 695 149" fill="none" stroke="#d6b656" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 662px; height: 1px; padding-top: 156px; margin-left: 32px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><b><font style="font-size: 16px;">Notes</font></b></div></div></div></foreignObject><text x="363" y="167" fill="rgb(0, 0, 0)" font-family="IBM Plex Sans" font-size="11px" text-anchor="middle">Notes</text></switch></g></g><g/><g/><g><rect x="73.11" y="343" width="587.89" height="180" rx="16.2" ry="16.2" fill="#f5f5f5" stroke="#666666" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 433px; margin-left: 91px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>When the response received is an empty JSON, in general, this could mean a couple of things:</div><div><ol style="padding-left: 30px; margin-top: 5px; margin-bottom: 5px;"><li>We made a logical error in our request parameters. The query is syntactically correct but the logic is flawed</li><li>No logical error but there are no records that correspond to our request query</li><li>Request with the latest offset is empty, which means that we have exhausted all the records for our request</li></ol><div>For our request logic, the above conditions *should* not be met for the following reason:</div></div><div><ol style="padding-left: 30px; margin-top: 5px; margin-bottom: 0px;"><li>Our request is fairly simple as we are just retrieving all the taxi trip records within the particular month indicated in our request (WHERE pickup_dtime &gt;= month_start AND pickup_dtime &lt; next_month_start)</li><li>We are guaranteed to have at least one (1) record for our request</li><li>Every request in the request loop is guaranteed to return a record since the current logic will not send a request with an offset that exceeds the total record for our request. However, there is an exception to this as discussed in Notes #4 and #5</li></ol></div><div><br /></div></div></div></div></foreignObject><text x="91" y="436" fill="#333333" font-family="IBM Plex Sans" font-size="11px">When the response received is an empty JSON, in general, this could mean a couple of things:...</text></switch></g></g><g><rect x="65" y="418" width="20.27" height="30" rx="3.04" ry="3.04" fill="#ffff00" stroke="#808080" stroke-width="2" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 433px; margin-left: 66px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">2</div></div></div></foreignObject><text x="75" y="437" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">2</text></switch></g></g><g/><g><rect x="73.11" y="532" width="587.89" height="255" rx="22.95" ry="22.95" fill="#f5f5f5" stroke="#666666" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 660px; margin-left: 91px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>To process the non-empty JSON response, we initialize a <b>line accumulator</b> and a <b>accumulator limit. </b>The line accumulator is simply a list that collects the cleaned JSON lines we receive from the stream, while the accumulator limit is the max number of JSON lines we will store in the line accumulator (set to 50k). <span style="background-color: initial;">When the limit is reached, we save the accumulated JSON lines as CSV. (see <i><b>line accumulator loop</b></i>)</span></div><div><span style="background-color: initial;"><br /></span></div><div><span style="background-color: initial;">Technically, we could have just streamed the whole response body (the JSON response) instead of batch saving it. However, I felt that batch saving is a more efficient option for the following reason:</span></div><div><ol style="margin-top: 5px; margin-bottom: 5px;"><li>Since the streamed lines are saved in the memory, batch saving will reduce memory usage. This is particularly helpful in my case considering I am using Dagster to make multiple requests to fetch the different partitions of the dataset</li><li>As each JSON line is received, we can immediately perform initial data cleaning and transformation before saving the lines.</li><li> Although not yet implemented, we could implement resumable downloads in the case the stream gets cut abruptly by using the number of records we have downloaded so far and using it along with offset to resume our download</li></ol><div>In short, stream downloading + batch saving = efficient and memory-friendly 💙</div></div></div></div></div></foreignObject><text x="91" y="663" fill="#333333" font-family="IBM Plex Sans" font-size="11px">To process the non-empty JSON response, we initialize a line accumulator and a accumulator limit. The...</text></switch></g></g><g><rect x="65" y="644.31" width="20.27" height="30.38" rx="3.04" ry="3.04" fill="#ffff00" stroke="#808080" stroke-width="2" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 660px; margin-left: 66px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">3</div></div></div></foreignObject><text x="75" y="663" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">3</text></switch></g></g><g/><g><rect x="73.11" y="796" width="587.89" height="129" rx="11.61" ry="11.61" fill="#f5f5f5" stroke="#666666" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 860px; margin-left: 91px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">When the end of response is reached we need to check if the line accumulator is empty to determine if we should continue the main request loop. <b>If it is empty, it implies that there are at least 500k records for our request.</b><div><br /><div>We can only verify that there are still more records to fetch by sending another request with the next offset:</div><div><ol style="margin-top: 5px; margin-bottom: 0px;"><li>If there are exactly 500k records, we will receive an empty response and we terminate the request loop (as per Note #2)<br /></li><li>If there are more than 500k records, we continue stream downloading the response until we receive the condition in Note #5</li></ol></div><div><span style="color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-wrap: nowrap; background-color: initial;">%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%22%20style%3D%22group%3Bautosize%3D1%3BresizeHeight%3D0%3BtreeFolding%3D0%3Bcomic%3D0%3Bcontainer%3D0%3BfixDash%3D0%3BallowArrows%3D0%3BnoLabel%3D0%3Boverflow%3Dvisible%3B%22%20vertex%3D%221%22%20connectable%3D%220%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%2267%22%20y%3D%22184%22%20width%3D%22596%22%20height%3D%22148%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3CmxCell%20id%3D%223%22%20value%3D%22We%20limit%20the%20response%20of%20each%20request%20to%20only%20return%20500k%20records%20at%20most%20(the%20%26lt%3Bb%26gt%3Bresponse%20limit%26lt%3B%2Fb%26gt%3B)%20to%20avoid%20large%20payloads%20that%20could%20negatively%20affect%20the%20processing%20of%20our%20request.%20During%20my%20crude%20testing%2C%20I%20would%20always%20encounter%20a%20server%20timeout%20error%20when%20my%20request%20doesn't%20have%20a%20limit.%20The%20500k%20limit%20seems%20to%20work%20fine%2C%20but%20I%20am%20yet%20to%20do%20rigorous%20tests%20to%20determine%20the%20optimal%20limit%20that%20would%20balance%20the%20server%20resources%2C%20my%20internet%20connection%2C%20and%20my%20RAM%26amp%3Bnbsp%3B%26amp%3Bnbsp%3B%26lt%3Bspan%20style%3D%26quot%3Bbackground-color%3A%20initial%3B%26quot%3B%26gt%3B%F0%9F%98%85%26lt%3B%2Fspan%26gt%3B%26lt%3Bdiv%26gt%3B%26lt%3Bbr%26gt%3B%26lt%3B%2Fdiv%26gt%3B%26lt%3Bdiv%26gt%3BSince%20the%20total%20records%20from%20our%20request%20will%20exceed%20this%20limit%2C%20we%20create%20a%20request%20loop%20that%20will%20continuously%20send%20our%20request%20to%20the%20server%20until%20all%20the%20records%20for%20our%20request%20has%20been%20exhausted.%26amp%3Bnbsp%3B%26lt%3Bspan%20style%3D%26quot%3Bbackground-color%3A%20initial%3B%26quot%3B%26gt%3BTo%20retrieve%20the%20next%20set%20of%20records%2C%20the%20request%20also%20includes%20an%20'%26lt%3B%2Fspan%26gt%3B%26lt%3Bb%20style%3D%26quot%3Bbackground-color%3A%20initial%3B%26quot%3B%26gt%3Boffset%26lt%3B%2Fb%26gt%3B%26lt%3Bspan%20style%3D%26quot%3Bbackground-color%3A%20initial%3B%26quot%3B%26gt%3B'%20parameter%20that%20is%20incremented%20by%20the%20response%20limit%20each%20time%20we%20send%20a%20new%20request%20to%20the%20server%2C%26lt%3B%2Fspan%26gt%3B%26lt%3B%2Fdiv%26gt%3B%22%20style%3D%22rounded%3D1%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3Balign%3Dleft%3BverticalAlign%3Dmiddle%3BfontFamily%3DIBM%20Plex%20Sans%3BfontSize%3D11%3BlabelBackgroundColor%3Dnone%3BspacingLeft%3D16%3BstrokeWidth%3D1%3BfillColor%3D%23f5f5f5%3BfontColor%3D%23333333%3BstrokeColor%3D%23666666%3BarcSize%3D9%3BspacingRight%3D8%3B%22%20vertex%3D%221%22%20parent%3D%222%22%3E%3CmxGeometry%20x%3D%228.11%22%20width%3D%22587.89%22%20height%3D%22148%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3CmxCell%20id%3D%224%22%20value%3D%221%22%20style%3D%22rounded%3D1%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3BfontFamily%3DHelvetica%3BfontSize%3D12%3BlabelBackgroundColor%3Dnone%3BfillColor%3D%23ffff00%3BstrokeColor%3D%23808080%3BstrokeWidth%3D2%3BfontStyle%3D1%3BallowArrows%3D0%3Bconnectable%3D0%3B%22%20vertex%3D%221%22%20parent%3D%222%22%3E%3CmxGeometry%20y%3D%2238.8125%22%20width%3D%2220.272108843537417%22%20height%3D%2230.375%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E</span></div></div></div></div></div></foreignObject><text x="91" y="864" fill="#333333" font-family="IBM Plex Sans" font-size="11px">When the end of response is reached we need to check if the line accumulator is empty to determine if...</text></switch></g></g><g><rect x="65" y="845.31" width="20.27" height="30.38" rx="3.04" ry="3.04" fill="#ffff00" stroke="#808080" stroke-width="2" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 861px; margin-left: 66px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">4</div></div></div></foreignObject><text x="75" y="864" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">4</text></switch></g></g><g/><g><rect x="73.11" y="186" width="587.89" height="148" rx="13.32" ry="13.32" fill="#f5f5f5" stroke="#666666" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 260px; margin-left: 91px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">We limit the response of each request to only return 500k records at most (the <b>response limit</b>) to avoid large payloads that could negatively affect the processing of our request. During my crude testing, I would always encounter a server timeout error when my request doesn't have a limit. The 500k limit seems to work fine, but I am yet to do rigorous tests to determine the optimal limit that would balance the server resources, my internet connection, and my RAM  <span style="background-color: initial;">😅</span><div><br /></div><div>Since the total records from our request will exceed this limit, we create a request loop that will continuously send our request to the server until all the records for our request has been exhausted. <span style="background-color: initial;">To retrieve the next set of records, the request also includes an '</span><b style="background-color: initial;">offset</b><span style="background-color: initial;">' parameter that is incremented by the response limit each time we send a new request to the server,</span></div></div></div></div></foreignObject><text x="91" y="263" fill="#333333" font-family="IBM Plex Sans" font-size="11px">We limit the response of each request to only return 500k records at most (the response limit) to avoi...</text></switch></g></g><g><rect x="65" y="244.81" width="20.27" height="30.38" rx="3.04" ry="3.04" fill="#ffff00" stroke="#808080" stroke-width="2" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 260px; margin-left: 66px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">1</div></div></div></foreignObject><text x="75" y="264" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">1</text></switch></g></g><g/><g><rect x="73.58" y="935" width="587.89" height="124" rx="11.16" ry="11.16" fill="#f5f5f5" stroke="#666666" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 562px; height: 1px; padding-top: 997px; margin-left: 92px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 11px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">When the line accumulator is empty even after we have finished streaming the response of the current request, this means that <b>t</b><span style="background-color: initial;"><b>he accumulator limit is not reached (accumulated less than 50k records), which also means the total response is less than than our request limit of 500k records.</b></span><div><span style="background-color: initial;"><b><br /></b></span></div><div><span style="background-color: initial;">When this condition is met,<b> we end our request loop</b> since there are no more data to fetch. However, <b>this only works when the request limit is divisible by the line limit. </b>Otherwise, our request loop will prematurely end after the first request <b>since the last batch of lines that will be accumulated will always be less than the accumulator limit</b>, triggering this condition.</span></div></div></div></div></foreignObject><text x="92" y="1000" fill="#333333" font-family="IBM Plex Sans" font-size="11px">When the line accumulator is empty even after we have finished streaming the response of the current r...</text></switch></g></g><g><rect x="64.53" y="981.81" width="20.27" height="30.38" rx="3.04" ry="3.04" fill="#ffff00" stroke="#808080" stroke-width="2" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 18px; height: 1px; padding-top: 997px; margin-left: 66px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">5</div></div></div></foreignObject><text x="75" y="1001" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">5</text></switch></g></g><g><rect x="283" y="1108" width="1027" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1143px; margin-left: 797px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Architects Daughter&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: nowrap;"><font size="1" face="IBM Plex Sans"><b style="font-size: 48px;">Stream Downloading the API Response Body</b></font></div></div></div></foreignObject><text x="797" y="1147" fill="#384b63" font-family="Architects Daughter" font-size="12px" text-anchor="middle">Stream Downloading the API Response Body</text></switch></g></g><g><rect x="1338" y="911" width="235" height="177" rx="5.31" ry="5.31" fill="#f0f0f0" stroke="none" pointer-events="all"/></g><g><rect x="1427" y="915" width="57" height="26" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 928px; margin-left: 1456px;"><div data-drawio-colors="color: #384b63; background-color: #FFFF00; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; font-weight: bold; background-color: rgb(255, 255, 0); white-space: nowrap;">Legend</div></div></div></foreignObject><text x="1456" y="932" fill="#384b63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle" font-weight="bold">Legend</text></switch></g></g><g/><g><rect x="1403" y="938.36" width="98.5" height="20.09" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 948px; margin-left: 1405px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Initial node</div></div></div></foreignObject><text x="1405" y="951" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Initial node</text></switch></g></g><g><rect x="1403" y="958.36" width="98.5" height="20.09" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 968px; margin-left: 1405px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Action. 1 in, 1 out</div></div></div></foreignObject><text x="1405" y="971" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Action. 1 in, 1 out</text></switch></g></g><g><rect x="1403" y="979.36" width="115" height="20.09" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 113px; height: 1px; padding-top: 989px; margin-left: 1405px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Decision node. 1 in, 2+ outs</div></div></div></foreignObject><text x="1405" y="992" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Decision node. 1 in, 2+ outs</text></switch></g></g><g><rect x="1403" y="999.36" width="98.5" height="20.09" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 1009px; margin-left: 1405px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Merge node. 2+ ins, 1 out</div></div></div></foreignObject><text x="1405" y="1012" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Merge node. 2+ ins, 1 out</text></switch></g></g><g><rect x="1403" y="1019.36" width="98.5" height="20.09" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 1029px; margin-left: 1405px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Control flow</div></div></div></foreignObject><text x="1405" y="1032" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Control flow</text></switch></g></g><g><rect x="1403" y="1040.36" width="129.82" height="20.09" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 128px; height: 1px; padding-top: 1050px; margin-left: 1405px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Control flow w/ emphasis on the flow that will continue a loop</div></div></div></foreignObject><text x="1405" y="1053" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Control flow w/ emphasis on the...</text></switch></g></g><g><rect x="1403" y="1060.36" width="98.5" height="20.09" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 96px; height: 1px; padding-top: 1070px; margin-left: 1405px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 8px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Final node</div></div></div></foreignObject><text x="1405" y="1073" fill="#384b63" font-family="IBM Plex Sans" font-size="8px">Final node</text></switch></g></g><g/><g><ellipse cx="1382.86" cy="948.86" rx="4.86" ry="4.86" fill="#394a63" stroke="#394a63" pointer-events="all"/></g><g><rect x="1351.43" y="959.15" width="36.29" height="18.14" rx="5" ry="5" fill="#dae8fc" stroke="#556f94" stroke-width="2" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 34px; height: 1px; padding-top: 968px; margin-left: 1352px;"><div data-drawio-colors="color: #384b63; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: &quot;IBM Plex Sans&quot;; color: rgb(56, 75, 99); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 8px;">Action</font></div></div></div></foreignObject><text x="1370" y="972" fill="#384b63" font-family="IBM Plex Sans" font-size="12px" text-anchor="middle">Action</text></switch></g></g><g><path d="M 1375.57 985.05 L 1377.59 983.02 Q 1379.62 981 1383.15 984.53 L 1385.44 986.81 Q 1387.72 989.1 1384.18 992.63 L 1381.9 994.91 Q 1379.62 997.2 1376.08 993.66 L 1373.8 991.38 Q 1371.52 989.1 1373.54 987.07 Z" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1375.57 1005 L 1377.59 1002.97 Q 1379.62 1000.95 1383.16 1004.48 L 1385.44 1006.77 Q 1387.72 1009.05 1384.18 1012.58 L 1381.9 1014.87 Q 1379.62 1017.15 1376.08 1013.61 L 1373.8 1011.33 Q 1371.52 1009.05 1373.55 1007.02 Z" fill="#dae8fc" stroke="#556f94" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1355.32 1029 L 1381.35 1029" fill="none" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1386.6 1029 L 1379.6 1031.33 L 1381.35 1029 L 1379.6 1026.66 Z" fill="#6c8ebf" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 1355.32 1051 L 1381.35 1051" fill="none" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="stroke" stroke-dasharray="8" style="animation: 500ms linear 0s infinite normal none running ge-flow-animation-g_2tIH1OXfAzrHx0g_cj; stroke-dashoffset: 16;"/><path d="M 1386.6 1051 L 1379.6 1053.34 L 1381.35 1051 L 1379.6 1048.67 Z" fill="#6c8ebf" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="all"/></g><g><ellipse cx="1382.86" cy="1069.96" rx="2.9160000000000004" ry="2.9160000000000004" fill="#394a63" stroke="#394a63" pointer-events="all"/><ellipse cx="1382.86" cy="1069.96" rx="4.86" ry="4.86" fill="none" stroke="#394a63" pointer-events="all"/></g></g></svg>